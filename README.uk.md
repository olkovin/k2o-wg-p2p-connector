# k2o-wg-p2p-connector

[English version](README.md)

Автоматизоване створення WireGuard P2P тунелю між двома MikroTik RouterOS пристроями.

## Огляд

Цей скрипт автоматизує створення WireGuard point-to-point тунелю між двома MikroTik роутерами. Запустіть один і той же скрипт на обох пристроях — обмін ключами відбудеться автоматично через тимчасове SSTP з'єднання.

## Можливості

- **Один скрипт для обох сторін** — той самий файл запускається на сервері та клієнті
- **Автоматичний обмін ключами** — без ручного копіювання публічних ключів
- **Унікальний ID тунелю** — кожен тунель отримує ідентифікатор на основі timestamp
- **Просте видалення** — автоматично згенерований скрипт для чистого видалення
- **Інтеграція з firewall** — автоматично відкриває порт WireGuard на сервері

## Швидкий старт

1. Завантажте `wg-p2p-connector.rsc` на обидва роутери
2. Відредагуйте секцію конфігурації на обох роутерах:
   ```routeros
   :global p2pRole "server"              # або "client"
   :global p2pServerAddress "1.2.3.4"    # публічний IP сервера
   :global p2pSstpPass "YourPassword"    # однаковий на обох
   ```
3. На **СЕРВЕРІ** (роутер з публічним IP) запустіть першим:
   ```routeros
   /import wg-p2p-connector.rsc
   ```
4. На **КЛІЄНТІ** запустіть протягом 5 хвилин:
   ```routeros
   /import wg-p2p-connector.rsc
   ```
5. Готово! Перевірте:
   ```routeros
   /ping 10.200.0.1   # з клієнта
   /ping 10.200.0.2   # з сервера
   ```

## Довідник конфігурації

### Базові (обов'язкові)

| Змінна | Опис | Приклад |
|--------|------|---------|
| `p2pRole` | Роль роутера | `"server"` або `"client"` |
| `p2pServerAddress` | Публічний IP/FQDN сервера | `"vpn.example.com"` |
| `p2pSstpPass` | Пароль для обміну ключами | `"SecurePass123!"` |

### Основні (зі значеннями за замовчуванням)

| Змінна | За замовчуванням | Опис |
|--------|------------------|------|
| `p2pTunnelName` | `"tunnel1"` | Коротка назва тунелю |
| `p2pServerWgIP` | `"10.200.0.1"` | WireGuard IP сервера |
| `p2pClientWgIP` | `"10.200.0.2"` | WireGuard IP клієнта |
| `p2pWgNetmask` | `"/30"` | Маска мережі |

### Розширені (опціональні)

| Змінна | За замовчуванням | Опис |
|--------|------------------|------|
| `p2pWgPort` | `51820` | UDP порт WireGuard |
| `p2pSstpPort` | `443` | TCP порт SSTP для обміну ключами |
| `p2pSstpUser` | `"p2p-k2o-exchange"` | SSTP ім'я користувача |
| `p2pTimeout` | `300` | Таймаут очікування сервером (секунди) |

## Як це працює

```
СЕРВЕР (запускається першим)           КЛІЄНТ (запускається другим)
────────────────────────────           ──────────────────────────────
1. Генерує Tunnel ID
2. Створює WG інтерфейс
3. Запускає SSTP сервер
4. Чекає клієнта...                    1. Створює WG інтерфейс
                                       2. Підключається по SSTP
        ◄─── SSTP тунель ───►
                                       3. Обмін ключами через SSH
5. Отримує pubkey клієнта              4. Отримує pubkey сервера + ID
6. Додає WG peer                       5. Додає WG peer
7. Додає firewall правило
8. Вимикає SSTP сервер                 6. Відключається від SSTP
9. Генерує скрипт видалення            7. Генерує скрипт видалення

        ◄─── WireGuard тунель ───►
```

## Видалення

Для видалення тунелю запустіть на кожному роутері:
```routeros
/system script run remove-p2p-k2o-{ID}
```

Назва скрипта видалення показується в кінці розгортання.

## Приклади маршрутизації

Скрипт створює лише point-to-point зв'язність. Для маршрутизації додаткових мереж див. [документацію MikroTik WireGuard](https://help.mikrotik.com/docs/display/ROS/WireGuard).

**Маршрутизувати LAN клієнта (192.168.88.0/24) через тунель (на сервері):**
```routeros
/ip route add dst-address=192.168.88.0/24 gateway=10.200.0.2
```

**Маршрутизувати весь трафік через тунель (на клієнті):**
```routeros
/ip route add dst-address=0.0.0.0/0 gateway=10.200.0.1 distance=10
```

## Ручний обмін ключами

Якщо автоматичний обмін не вдався, скрипт покаже інструкції для ручного копіювання ключів.

## Вимоги

- MikroTik RouterOS 7.x з підтримкою WireGuard
- Сервер повинен мати публічний IP (або port forwarding для портів SSTP та WG)
- Клієнт повинен мати доступ до сервера на порту SSTP (443 за замовчуванням)

## Ліцензія

MIT License — див. [LICENSE](LICENSE)

## Підтримати проект

Якщо це було корисно:

- **GitHub**: Поставте зірку репозиторію
- **PayPal**: [paypal.me/olekovin](https://paypal.me/olekovin)
- **Monobank**: `4441 1144 6258 5765`
- **Crypto**: Див. нижче

<details>
<summary>Криптовалютні донати</summary>

- **BTC**: `bc1qxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
- **ETH**: `0xXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX`
- **USDT (TRC20)**: `TXxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

</details>

---

Зроблено за допомогою ШІ [@olekovin](https://t.me/olekovin) | [k2o.cc](https://k2o.cc)
